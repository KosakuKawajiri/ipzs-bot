name: IPZS bot

on:
  workflow_dispatch:
  schedule:
    # Dicembre - Giugno: ogni 5 minuti dalle 6:00 alle 23:55
    - cron: '*/5 6-23 * 12,1,2,3,4,5,6 *'
    # Luglio - Novembre: ogni 15 minuti dalle 6:00 alle 23:45
    - cron: '*/15 6-23 * 7,8,9,10,11 *'

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run script solo tra le 6:00 e le 23:59
        run: |
          hour=$(date +%H)
          if [ "$hour" -ge 6 ] && [ "$hour" -lt 24 ]; then
            echo "⏰ Avvio script: orario valido ($hour:00)"
            python main.py
          else
            echo "❌ Orario non valido ($hour:00): script non eseguito."
          fi

      - name: Commit & Push se seen.txt cambia
        run: |
          git config user.name "actions-user"
          git config user.email "actions@github.com"
          git add seen.txt
          git diff --cached --quiet || {
            git commit -m "Aggiorna seen.txt"
            git push
          }
